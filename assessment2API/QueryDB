/* GET All Sensor data */
router.get("/sensor", function (req, res) {
    const allSensors = db("brisbane_gp");
    res.send(allSensors);
    console.log("API is called");
});

    // try {
    //     const allSensors = await db("SELECT pressurematid, pressurevalue FROM iab330nodered");
    //     res.json(allSensors)
    //     console.log(allSensors)
    //     next();
    // } catch(err) {
    //     res.status(500).json({message: "Error getting data"})
    // }

/* GET User and Lock Data Filtered by User_ID */
router.get("/user&lock/:userid", function (req, res) {
    const rawData = db("SELECT userid, lockid FROM iab330nodered");
    const filteredData = rawData.find(data => data.userid === req.params.userid);
    if(!filteredData){
        res.status(404).send("No Data Found");    
    } else {
        res.json(filteredData);    
    }

    // try {
    //     const rawData = db("SELECT userid, lockid FROM iab330nodered");
    //     const filteredData = rawData.find(data => data.userid === req.params.userid);
    //     res.json(filteredData);
    // } catch(err) {
    //     res.status(500).json({message: "Error getting data"})
    // }
});

/* GET2 Door Lock and Mat Data filtered by Door Lock */
router.get("/doorlock/:lockid", function (req, res) {
    const rawData = db(
        "SELECT lockid, pressurematid, pressurematvalues FROM iab330nodered"
        );
    const filteredData = rawData.find(data => data.lockid === req.params.lockid);
    if(!filteredData){
        res.status(404).send("No Data Found");    
    } else {
        res.json(filteredData);    
    }

    // try {
    //     const rawData = db(
    //         "SELECT lockid, pressurematid, pressurematvalues FROM iab330nodered"
    //         );
    //     const filteredData = rawData.find(data => data.lockid === req.params.lockid);
    //     res.json(filteredData);
    // } catch(err) {
    //     res.status(500).json({message: "Error getting data"})
    // }
});

/* GET Lock and Timestamp Data filtered by Lock */
router.get("/lock&time/:lockid", function (req, res) {
    const rawData = db(
        "SELECT lockid, timestamp FROM iab330nodered"
        );
    const filteredData = rawData.find(data => data.lockid === req.params.lockid);
    if(!filteredData){
        res.status(404).send("No Data Found");    
    } else {
        res.json(filteredData);    
    }

    // try {
    //     const rawData = db(
    //         "SELECT lockid, timestamp FROM iab330nodered"
    //         );
    //     const filteredData = rawData.find(data => data.lockid === req.params.lockid);
    //     res.json(filteredData);
    // } catch(err) {
    //     res.status(500).json({message: "Error getting data"})
    // }
});

/* GET Mat and Timestamp data filter by Door Lock*/
router.get("/mat&time/:lockid", function (req, res) {
    // try {
    //     const rawData = db(
    //         "SELECT lockid, timestamp, pressurevalue FROM iab330nodered"
    //         );
    //     const filteredData = rawData.find(data => data.lockid === req.params.lockid);
    //     res.json(filteredData);
    // } catch(err) {
    //     res.status(500).json({message: "Error getting data"})
    // }

    const rawData = db(
        "SELECT lockid, pressurematid, pressurevalues, timestamp FROM iab330nodered"
        );
    const filteredData = rawData.find(data => data.lockid === req.params.lockid);
    if(!filteredData){
        res.status(404).send("No Data Found");    
    } else {
        res.json(filteredData);    
    }
});

/*GET all user Data */
router.get("/users", function (req, res) {
    // try {
    //     const rawData = db(
    //         "SELECT userid FROM iab330nodered"
    //         );
    //     res.json(rawData);
    // } catch(err) {
    //     res.status(500).json({message: "Error getting data"})
    // }

    const allUsers = db(
        "SELECT userid FROM iab330nodered"
        );
    res.send(allUsers);
    console.log("API is called");
});

/*GET User ID filtered By ID*/
router.get("/users/:userid", function (req, res) {
    // try {
    //     const rawData = db(
    //         "SELECT userid FROM iab330nodered"
    //         );
    //     const filteredData = rawData.find(data => data.userid === req.params.userid);
    //     res.json(filteredData);
    // } catch(err) {
    //     res.status(500).json({message: "Error getting data"})
    // }

    const rawData = db(
        "SELECT userid FROM iab330nodered"
        );
    const filteredData = rawData.find(data => data.userid === req.params.userid);
    if(!filteredData){
        res.status(404).send("No Data Found");    
    } else {
        res.json(filteredData);    
    }
});
